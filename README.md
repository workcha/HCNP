# HCNP--R&S部署笔记
## RIP

**RIP在大型网络中部署所面临的问题**


 RIP特性             | 带来的问题               
 ------------------- |-------------------------
 逐级收敛            | 收敛慢，故障恢复时间长 
 分布式路由计算      | 缺少对全局网络拓扑的了解
 以“跳数”为度量      | 存在选择次优路径的风险

**解决RIP的问题**

RIP的问题               |优化或解决的方式
------------------------|---------------------
收敛慢，故障恢复时间长  |触发更新
缺少对全局网络拓扑的了解|路由器基于拓扑信息，独立计算路由
存在选择次优路径的风险  |将链路带宽作为选路参考值

*在 “收到更新”、“计算路由”、“发送更新”的路由收敛过程中，RIP的局限性
在于路由器需要在完成路由计算之后才可以向邻居发送路由变化通知。如果将
这个过程调整为：“收到更新”、 “发送更新”、“计算路由”，即路由器从邻居
收到路由更新后立刻向其他邻居路由器转发，然后再本地计算新的路由。这样
的收敛方式可以大大降低全网路由收敛的时间。(计算耗费时间最多)

*因为RIP路由器仅从邻居路由器获取路由信息，所以对于非最优或者错误路由
信息，RIP路由器并不能识别或屏蔽。解决此问题的关键最佳方式是路由器集
全网的信息，并基于这些信息独立计算路由。(这个好像耗费的储存会很多)

*基于跳数的度量方式并没有考虑数据包的链路转发延迟，如果采用以累积为
选路参考依据，可以更好的规避选择次优路径的风险。


## 链路状态路由协议OSPF
	
### 链路状态(路由器的接口状态)，OSPF路由器的链路状态包含以下信息:
* 该接口的IP地址及掩码
* 该接口的带宽
* 该接口所连接的邻居
* 等等

### OSPF传输的信息：
* 并不直接传输各路由器的路由表，而是链路状态信息，然后各路由器基
于该信息独立计算路由

### 链路状态数据库：
* 各路由器各自维护一个链路状态数据库
* 邻居路由器间先同步链路状态数据库
* 再各自基于SPF(最短路径算法)计算最优路由,从而提高收敛速度

### 度量方式：
* OSPF将链路带宽作为选路时的参考依据

## OSPF的路由计算过程（简化版）;
	
* 路由之间发现并建立邻居关系
* 每台路由器产生并向邻居泛洪链路状态信息，同时收集来自其他路由器链路状态信息，
完成LSDB(链路状态数据库)的同步
* 每台路由器基于LSDB通过SPF算法，计算得到一棵树以自己为根的SPT（短路径树），
再以SPT为基础计算去往各邻居连接网络的最优路由，并形成路由表

## Router ID(32位无符号整数，格式与IP地址一样
	
### 选举准则
* 手动配置（建议）
* 路由器使用回环接口中最大的IP地址作为ROUTER ID
* 无配置回环接口就是物理接口最大ip地址

## HELLO报文

* OSPF通过HElleo报文发现路由器并且建立邻居关系
* 形成邻居关系后，再通过Hello报文完成一些参数的协商
* 邻居关系建立后，周期性地发送hello报文维持关系，一段时间没收到就会中断OSPF邻居关系

## OSPF支持网络类型：
### P2P网络
* 仅两台路由器互连
* 支持广播和组播

### 广播型网络
* 两台或者两台路由器以上共享介质互连
* 支持广播、组播

### NBMA网络（少见）
* 两台或者两台以上路由器通过VC(某种互联网设备)互联
* 不支持广播、组播

### 网络类型-P2MP网络
*多个点到点(P2P集合)网络的集合
*支持广播、组播

## OSPF报文类型
### HEELO
* 发现和维护邻居关系
### DATABASE DESCRIPTON
* 交互链路状态数据库摘要
### LINK STATE REQUEST 
* 请求特定的链路状态信息
### LINK STATE UPDATE
* 发送详细的链路状态信息
### LINK STATE ACK
* 发送确认报文


## OSPF报文的功能需求

功能          |实现分析
--------------|---------
发现邻居与保持|Hello机制即可实现
LSA同步       |双方互相发送LSA，完成同步，同时同步速度更快，占用资源更少
可靠性        |确保LSA同步过程的可靠性

